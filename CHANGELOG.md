# 更新日志

## [未发布]

### Windows DLL加载失败修复 (2026-01-18)
- 🐛 **修复Python DLL无法加载的问题** ✅ **严重Bug**
  - 错误：`[PYI-16688:ERROR] Failed to load Python DLL python311.dll`
  - 根本原因：PyInstaller的strip和UPX压缩破坏了DLL
  - 解决方案：禁用strip和upx优化，确保DLL完整性
  - 代价：包体积会增大，但稳定性和兼容性大幅提升

### Windows bat编码问题修复 (2026-01-18)
- 🐛 **修复bat文件中文编码导致的启动失败** ✅ **重要**
  - 创建纯ASCII版本的启动脚本：`start.bat` 和 `start_debug.bat`
  - 解决"'录' 不是内部或外部命令"错误
  - 在所有Windows系统上都能正常工作
  - 保留中文版本作为备用

- 📝 **更新Windows文档** ✅
  - 添加编码问题说明和解决方案
  - 创建 `START_HERE.txt` 快速引导文件（纯ASCII）
  - 更新所有文档，优先推荐英文文件名版本

### Windows启动问题修复 (2026-01-18)
- 🐛 **修复Windows版本窗口一闪而过的问题** ✅ **重要**
  - 增强的错误处理和日志记录
  - 自动端口检测和切换（5000-5009）
  - 程序出错时等待用户按键，显示详细错误信息
  - 创建日志目录，记录完整的启动和错误日志
  - 自动打开浏览器访问应用
  
- ✨ **新增Windows启动脚本** ✅
  - `启动.bat`：简单易用的普通启动脚本
  - `调试模式启动.bat`：显示详细调试信息的启动脚本
  - 自动检测可执行文件和Python脚本
  - 退出时暂停，方便查看错误信息
  - 提供查看日志文件的选项
  
- 📝 **完善Windows使用文档** ✅
  - `Windows使用说明.md`：详细的问题诊断指南
  - `README_Windows.txt`：快速开始指南（包含在Windows发布包中）
  - `Windows问题修复说明.md`：技术修复文档
  - 包含常见问题、解决方法、日志查看等
  
- 🔧 **优化Windows构建配置** ✅
  - 更新 `build.spec` 包含启动脚本
  - 更新 GitHub Actions 自动复制使用文档到Windows构建
  - 添加测试脚本 `test_windows_fix.py` 验证修复

### 性能优化 (2026-01-18)
- ⚡ **大幅优化打包大小** ✨ **重要**
  - 排除30+个不必要的Python模块
  - 启用strip移除调试符号
  - 优化UPX压缩配置
  - 使用最大压缩级别
  - 预计减小50-70%的文件大小
  - 优化后预期大小：50-80MB（压缩后20-35MB）

### 重要更新 (2026-01-18)
- 🌐 **实现完全离线支持** ✅ **重要**
  - 下载ECharts 5.4.3库到本地（1.0MB）
  - 移除CDN依赖，支持无网络环境使用
  - 解决Windows防火墙阻止CDN访问的问题
  - 适用于内网、隔离环境、离线场景
  - 更新PyInstaller配置，打包静态资源

### 修复问题 (2026-01-18)
- 🐛 **修复Windows环境echarts未定义错误** ✅
  - 根本原因：CDN加载被防火墙阻止
  - 解决方案：将ECharts库本地化
  - 添加离线使用文档和说明
  
- 🐛 **修复GitHub Actions构建失败** ✅
  - 更新 `actions/upload-artifact` 从 v3 到 v4
  - 更新 `actions/setup-python` 从 v4 到 v5
  - 更新 `softprops/action-gh-release` 从 v1 到 v2
  - 解决了 v3 artifact actions 弃用导致的构建失败问题

### 新增功能
- ✅ **GitHub Actions集成**：自动构建Windows、macOS、Linux三个平台的可执行文件
- ✅ **一键部署脚本**：`init_git.sh` 帮助快速推送到GitHub
- ✅ **PyInstaller配置**：`build.spec` 配置文件，优化打包设置
- ✅ **测试脚本**：`test_app.py` 用于验证统计功能
- ✅ **完整部署指南**：`部署指南.md` 包含本地开发、GitHub部署、测试验证等完整流程

### 修复问题
- 🐛 **修复缺陷停留时长图表不显示的问题** ✅ **已验证**
  - 增加了对"标题"列的检查
  - 添加了None值过滤
  - 确保数据类型转换正确
  - 添加了空数据处理逻辑
  - **扩展状态映射**：增加了"待解决"和"处理中"的映射支持
  - 测试结果：成功统计20个待修复状态的缺陷，停留时长从1846天到2195天

### 改进
- 📝 添加了详细的GitHub Actions部署文档（GITHUB_DEPLOY.md）
- 📝 添加了完整部署指南（部署指南.md）
- 📝 更新了README，添加GitHub Actions说明
- 📝 添加了CHANGELOG更新日志
- 🔧 添加了.gitignore文件，优化Git仓库管理
- 🔧 创建了uploads目录占位文件
- 🔧 扩展状态映射规则，兼容更多状态命名

### 状态映射规则（已扩展）
现在支持以下状态映射为"待修复"：
- 新建 → 待修复
- 修复中 → 待修复
- 待修复 → 待修复
- 待解决 → 待修复 ✨ **新增**
- 处理中 → 待修复 ✨ **新增**

---

## v2.0.0 (2026-01-18)

### 重大更新
- ✅ **重新实现4个统计图表**：按照需求图片正确实现统计方法
- ✅ **状态映射功能**：新建、修复中、待修复 → 统一映射为"待修复"
- ✅ **模块过滤功能**：支持多选模块，动态过滤数据
- ✅ **Web实时展示**：不再生成Excel文件，直接在页面展示图表
- ✅ **ECharts图表库**：使用专业图表库，支持交互

### 4个核心图表
1. **不同状态下的缺陷数量统计**（柱状图）
   - 应用状态映射规则
   - count(标题) 按状态分组

2. **缺陷停留时长分析**（柱状图）
   - 仅统计待修复状态
   - 计算：当前日期 - 创建日期（天数）

3. **每日新增/修复缺陷情况**（双线折线图）
   - 每日新增：根据创建时间统计
   - 每日修复：待验证（更新时间）+ 已关闭（完成时间）

4. **缺陷分析归类统计**（饼图）
   - 根据缺陷分析类型字段
   - 圆环饼图展示占比

### 技术改进
- 后端：Flask返回JSON数据
- 前端：ECharts 5.4.3渲染图表
- 数据处理：优化Pandas统计逻辑
- UI设计：现代化渐变背景，响应式布局

---

## v1.0.0 (初始版本)

### 基础功能
- 上传Excel文件
- 生成Excel统计分析sheet
- 包含多个统计图表
- 下载包含统计的新文件

---

## 版本说明

### 语义化版本号

本项目遵循[语义化版本](https://semver.org/lang/zh-CN/)规范：

- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 发布类型

- **[未发布]**：开发中的功能，尚未正式发布
- **vX.Y.Z**：已发布的版本，包含发布日期

### 变更类型

- ✅ **新增**：新功能
- 🔄 **变更**：已有功能的变更
- 🗑️ **废弃**：即将移除的功能
- ❌ **移除**：已移除的功能
- 🐛 **修复**：bug修复
- 🔒 **安全**：安全性修复
- 📝 **文档**：文档更新
- 🔧 **配置**：配置文件更新
- 🎨 **界面**：UI/UX改进

---

**保持更新！** 🚀

