# Excel缺陷数据统计分析工具 - 完整部署指南

## 📋 目录

1. [本地开发和运行](#本地开发和运行)
2. [GitHub Actions自动构建](#github-actions自动构建)
3. [测试验证](#测试验证)
4. [常见问题](#常见问题)

---

## 🏃 本地开发和运行

### 1. 启动Web应用

```bash
# 一键启动
./start.sh

# 或手动启动
source venv/bin/activate
python app.py
```

然后在浏览器打开：http://localhost:5000

### 2. 测试功能

```bash
# 运行测试脚本
source venv/bin/activate
python test_app.py
```

这会验证：
- ✅ 数据读取功能
- ✅ 模块提取功能  
- ✅ 状态映射功能
- ✅ 4个统计图表的数据生成

### 3. 生成示例数据

```bash
source venv/bin/activate
python create_sample_data.py
```

会生成包含50条记录的 `sample_defect_data.xlsx` 文件。

---

## 🚀 GitHub Actions自动构建

### 步骤1: 准备GitHub仓库

1. **在GitHub上创建新仓库**
   - 访问 https://github.com/new
   - 输入仓库名：`excel-draw-tool`
   - 选择 Public 或 Private
   - **不要**勾选 "Add a README file"
   - 点击 "Create repository"

### 步骤2: 推送代码

运行初始化脚本：

```bash
./init_git.sh
```

然后按照提示操作：

```bash
# 添加远程仓库（替换为你的用户名）
git remote add origin https://github.com/你的用户名/excel-draw-tool.git

# 推送到GitHub
git branch -M main
git push -u origin main
```

### 步骤3: 查看自动构建

1. 打开你的GitHub仓库
2. 点击 `Actions` 标签
3. 等待构建完成（约5-10分钟）
4. 构建完成后，在 `Artifacts` 部分可以下载文件

### 步骤4: 创建发布版本（可选）

创建带版本号的tag：

```bash
git tag v1.0.0
git push origin v1.0.0
```

这会触发构建并自动创建GitHub Release。

---

## 📦 构建产物说明

### Windows版本
- **文件**: `excel-draw-tool-windows.zip`
- **使用方法**:
  ```
  1. 解压zip文件
  2. 进入 excel-draw-tool 目录
  3. 双击 excel-draw-tool.exe
  4. 浏览器访问 http://localhost:5000
  ```

### macOS版本
- **文件**: `excel-draw-tool-macos.tar.gz`
- **使用方法**:
  ```bash
  tar -xzf excel-draw-tool-macos.tar.gz
  cd excel-draw-tool
  ./excel-draw-tool
  # 浏览器访问 http://localhost:5000
  ```
  
  如果提示"无法验证开发者"：
  ```bash
  xattr -cr excel-draw-tool
  ```

### Linux版本
- **文件**: `excel-draw-tool-linux.tar.gz`
- **使用方法**:
  ```bash
  tar -xzf excel-draw-tool-linux.tar.gz
  cd excel-draw-tool
  chmod +x excel-draw-tool
  ./excel-draw-tool
  # 浏览器访问 http://localhost:5000
  ```

---

## 🧪 测试验证

### 功能测试清单

#### 1. 上传功能测试
- [ ] 拖拽上传Excel文件
- [ ] 点击选择Excel文件
- [ ] 上传成功后显示模块列表

#### 2. 模块过滤测试
- [ ] 全选功能正常
- [ ] 取消全选功能正常
- [ ] 单独选择模块功能正常
- [ ] 选中数量显示正确

#### 3. 图表展示测试
- [ ] 图表1：不同状态下的缺陷数量统计（柱状图）
- [ ] 图表2：缺陷分析归类统计（饼图）
- [ ] 图表3：缺陷停留时长分析（柱状图）✅ 已修复
- [ ] 图表4：每日新增/修复缺陷情况（折线图）

#### 4. 状态映射测试
- [ ] 新建 → 待修复 ✅
- [ ] 修复中 → 待修复 ✅
- [ ] 待修复 → 待修复 ✅
- [ ] 待解决 → 待修复 ✅
- [ ] 处理中 → 待修复 ✅

#### 5. 交互功能测试
- [ ] 鼠标悬停显示详细数据
- [ ] 图表缩放功能
- [ ] 重新选择模块生成新图表

---

## ❓ 常见问题

### Q1: 缺陷停留时长图表不显示？

**已修复！** 现在支持以下状态映射：
- 新建 → 待修复
- 修复中 → 待修复
- 待解决 → 待修复
- 处理中 → 待修复

确保Excel中有这些状态的数据即可。

### Q2: GitHub Actions构建失败？

**检查清单**:
1. 确保 `requirements.txt` 包含所有依赖
2. 检查 `build.spec` 配置是否正确
3. 查看Actions日志了解具体错误
4. 确认Python版本兼容性

### Q3: 本地测试PyInstaller构建

```bash
source venv/bin/activate
pip install pyinstaller
pyinstaller --clean --noconfirm build.spec
cd dist/excel-draw-tool
./excel-draw-tool
```

### Q4: 如何更新已发布的版本？

```bash
# 修改代码后
git add .
git commit -m "更新说明"
git push

# 创建新版本tag
git tag v1.0.1
git push origin v1.0.1
```

### Q5: Excel文件格式要求？

**必需列**:
- 标题
- 状态
- 创建时间
- 缺陷模块
- 缺陷分析类型

**可选列**:
- 更新时间（用于修复统计）
- 完成时间（用于修复统计）

---

## 🔧 本地构建可执行文件

### 安装PyInstaller

```bash
source venv/bin/activate
pip install pyinstaller
```

### 构建

```bash
pyinstaller --clean --noconfirm build.spec
```

### 测试

```bash
cd dist/excel-draw-tool
./excel-draw-tool  # macOS/Linux
# 或
excel-draw-tool.exe  # Windows
```

---

## 📊 项目统计

当前功能完成度：

- ✅ Web界面 - 100%
- ✅ 上传功能 - 100%
- ✅ 模块过滤 - 100%
- ✅ 状态映射 - 100%
- ✅ 图表1（状态统计） - 100%
- ✅ 图表2（分析类型） - 100%
- ✅ 图表3（停留时长） - 100% **已修复**
- ✅ 图表4（趋势分析） - 100%
- ✅ GitHub Actions - 100%
- ✅ 跨平台构建 - 100%

---

## 📚 相关文档

- [README.md](README.md) - 项目说明
- [QUICKSTART.md](QUICKSTART.md) - 快速开始
- [GITHUB_DEPLOY.md](GITHUB_DEPLOY.md) - GitHub部署详细说明
- [CHANGELOG.md](CHANGELOG.md) - 更新日志
- [使用说明.md](使用说明.md) - 详细使用说明

---

## 🎯 下一步计划

### 短期计划
- [ ] 添加数据导出功能（导出筛选后的数据）
- [ ] 支持更多图表类型
- [ ] 添加数据对比功能（多个文件对比）

### 长期计划
- [ ] 添加用户认证
- [ ] 支持数据库存储
- [ ] 实时数据更新
- [ ] 移动端适配

---

## 💡 最佳实践

### 代码提交
1. 提交前运行测试：`python test_app.py`
2. 使用有意义的提交信息
3. 小步提交，频繁推送

### 版本发布
1. 更新 `CHANGELOG.md`
2. 更新版本号
3. 创建tag并推送
4. 在GitHub Release中添加说明

### 文档维护
1. 保持README更新
2. 记录已知问题
3. 更新使用示例

---

**部署愉快！** 🚀✨

