# Excel缺陷数据统计分析工具 - 使用说明

## 一、功能概述

这是一个基于Python Flask的Web应用，用于自动分析Excel格式的缺陷数据并生成统计图表。

### 核心功能

✅ 自动生成4个主要统计图表（对应图片需求）：

1. **缺陷级别分布图**（柱状图） - 显示A/B/C/D各级别缺陷数量
2. **缺陷分类占比图**（饼图） - 显示功能、性能、界面等分类占比
3. **处理人工作量统计图**（柱状图） - 显示各处理人负责的缺陷数量
4. **缺陷趋势分析图**（折线图） - 显示创建和更新的时间趋势对比

✅ 附加数据表格：
- 按状态统计表格
- 按责任原因统计表格

✅ 其他功能：
- 支持拖拽上传Excel文件
- 自动在同一文件中新增"统计分析"sheet
- 下载包含统计图表的Excel文件

## 二、快速开始

### 方式1：一键启动（macOS/Linux）

```bash
./start.sh
```

### 方式2：手动启动

```bash
# 1. 激活虚拟环境
source venv/bin/activate

# 2. 安装依赖（首次运行）
pip install -r requirements.txt

# 3. 启动应用
python app.py
```

### 3. 访问应用

打开浏览器，访问：**http://localhost:5000**

## 三、Excel文件格式要求

### 必需列（用于主要图表）

| 列名 | 说明 | 示例 |
|------|------|------|
| **缺陷级别** | 缺陷优先级或严重程度 | A、B、C、D |
| **缺陷分类** | 缺陷的类型分类 | 功能缺陷、性能问题、界面问题、兼容性问题、安全问题 |
| **处理人** | 负责处理的人员姓名 | 张三、李四、王五 |
| **创建时间** | 缺陷创建的时间 | 2020-01-13 09:32:46 |

### 可选列（用于额外统计）

| 列名 | 说明 | 示例 |
|------|------|------|
| 事项ID | 缺陷唯一标识 | 55694 |
| 事项类型 | 事项类型 | 缺陷、任务 |
| 标签 | 缺陷标签 | 【二阶段】、【紧急】 |
| 状态 | 当前状态 | 待解决、处理中、已解决、已关闭 |
| 更新时间 | 最后更新时间 | 2020-01-13 09:35:13 |
| 完成时间 | 完成时间 | 2020-01-13 10:00:00 |
| 责任原因 | 缺陷产生原因 | 需求理解偏差、代码逻辑错误 |

### 示例数据格式

| 事项ID | 事项类型 | 标签 | 状态 | 缺陷分类 | 缺陷级别 | 处理人 | 创建时间 | 更新时间 |
|--------|----------|------|------|----------|----------|--------|----------|----------|
| 55694 | 缺陷 | 【二阶段】 | 待解决 | 功能缺陷 | A | 张三 | 2020-01-13 09:32:46 | 2020-01-13 09:35:13 |
| 55693 | 缺陷 | 【三阶段】 | 已关闭 | 界面问题 | B | 李四 | 2020-01-12 17:55:07 | 2020-01-13 09:23:27 |

## 四、使用步骤

### 步骤1：启动应用

运行 `./start.sh` 或 `python app.py`

### 步骤2：上传文件

1. 在浏览器中打开 http://localhost:5000
2. 点击上传区域或拖拽Excel文件（.xlsx格式）
3. 选择你的缺陷数据文件

### 步骤3：生成统计

1. 点击"开始分析"按钮
2. 等待处理（通常几秒钟）
3. 浏览器会自动下载包含统计图表的新Excel文件

### 步骤4：查看结果

1. 打开下载的Excel文件
2. 查看第一个sheet "统计分析"
3. 浏览4个主要图表和数据表格

## 五、生成的统计图表详解

### 图表1：缺陷级别分布图（柱状图）
- **位置**：统计分析sheet右上角（O列）
- **用途**：显示A、B、C、D各级别缺陷的数量分布
- **数据源**：缺陷级别列

### 图表2：缺陷分类占比图（饼图）
- **位置**：统计分析sheet右侧中间（O列，第18行）
- **用途**：显示功能缺陷、性能问题、界面问题等分类的占比
- **数据源**：缺陷分类列

### 图表3：处理人工作量统计图（柱状图）
- **位置**：统计分析sheet右侧下方（O列，第35行）
- **用途**：显示各处理人负责的缺陷数量（按数量降序排列）
- **数据源**：处理人列

### 图表4：缺陷趋势分析图（折线图）
- **位置**：统计分析sheet最右侧（AA列）
- **用途**：显示缺陷创建和更新的时间趋势对比（双线图）
- **数据源**：创建时间、更新时间列

### 额外数据表格

#### 表格1：按状态统计
- 显示：各状态（待解决、处理中、已解决、已关闭等）的缺陷数量
- 位置：数据区左侧

#### 表格2：按责任原因统计
- 显示：各原因导致的缺陷数量（按数量降序排列）
- 位置：数据区左侧，状态统计下方

## 六、测试工具

### 使用示例数据

项目已包含示例数据文件：`sample_defect_data.xlsx`

#### 测试步骤：
1. 启动应用
2. 上传 `sample_defect_data.xlsx`
3. 查看生成的统计文件

### 生成新的示例数据

```bash
# 激活虚拟环境
source venv/bin/activate

# 运行示例数据生成脚本
python create_sample_data.py
```

这将生成包含50条缺陷记录的新示例文件。

## 七、常见问题

### Q1: 上传失败，提示格式错误

**答**：请确保：
- 文件格式为 .xlsx（不支持旧版 .xls）
- 文件大小不超过16MB
- 文件未损坏

### Q2: 图表显示不完整或错误

**答**：请检查：
- Excel中是否有必需的列（缺陷级别、缺陷分类、处理人、创建时间）
- 列名是否精确匹配（注意中文字符）
- 数据中是否有大量空值

### Q3: 时间趋势图只显示一条线

**答**：这是正常的，如果Excel中没有"更新时间"列，折线图只会显示创建趋势。添加"更新时间"列后会显示双线对比。

### Q4: 如何修改图表样式？

**答**：可以编辑 `app.py` 中的 `create_statistics_sheet` 函数，调整：
- `chart.height` 和 `chart.width`：图表大小
- 图表位置：如 `'O1'`、`'O18'` 等单元格坐标
- 图表标题：`chart.title` 属性

### Q5: 如何在局域网中访问？

**答**：应用默认监听 `0.0.0.0:5000`，其他设备可以通过你的IP地址访问，例如：
```
http://192.168.1.100:5000
```

查看本机IP：
```bash
# macOS/Linux
ifconfig | grep "inet "
```

## 八、技术栈

- **后端框架**：Flask 3.0.0
- **数据处理**：Pandas 2.3.3+
- **Excel处理**：openpyxl 3.1.5
- **前端**：HTML5 + CSS3 + JavaScript
- **Python版本**：Python 3.8+

## 九、项目结构

```
excel-draw-tool/
├── app.py                    # Flask应用主文件
├── create_sample_data.py     # 示例数据生成脚本
├── requirements.txt          # Python依赖列表
├── start.sh                  # 一键启动脚本（macOS/Linux）
├── README.md                 # 项目说明文档
├── QUICKSTART.md             # 快速开始指南
├── 使用说明.md               # 详细使用说明（本文档）
├── templates/                # HTML模板文件夹
│   └── index.html           # 主页面模板
├── uploads/                  # 文件上传目录
├── venv/                     # Python虚拟环境
└── sample_defect_data.xlsx   # 示例数据文件
```

## 十、注意事项

⚠️ **重要提示**：

1. **数据安全**：上传的原始文件不会被修改，工具会生成新的文件
2. **文件大小**：支持的最大文件大小为16MB
3. **浏览器兼容**：建议使用Chrome、Edge、Safari等现代浏览器
4. **列名匹配**：Excel列名必须精确匹配（包括中文字符）
5. **时间格式**：时间列应为标准时间格式（如：2020-01-13 09:32:46）

## 十一、更新日志

### v1.0 (2026-01-18)
- ✅ 实现4个主要统计图表
- ✅ 支持缺陷级别、分类、处理人、趋势分析
- ✅ 美化Web界面，支持拖拽上传
- ✅ 自动生成统计分析sheet
- ✅ 提供示例数据文件

## 十二、联系与支持

如有问题或建议，请查看项目文档或提issue。

---

**祝使用愉快！** 📊✨

