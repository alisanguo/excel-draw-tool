# Excel缺陷数据统计分析工具

这是一个基于Python Flask的Web应用，用于处理Excel格式的缺陷数据，并在Web页面实时生成统计图表。

## 🎯 功能特点

### 🌐 完全离线支持
- ✅ **无需网络连接** - ECharts库已本地化
- ✅ **独立运行** - 所有资源都打包在可执行文件中
- ✅ **防火墙友好** - 不依赖任何CDN或外部资源
- ✅ **内网可用** - 适合各种隔离网络环境

### 📊 4个核心统计图表

1. **不同状态下的缺陷数量统计**（柱状图）
   - 统计方法：count(标题)
   - 状态映射：新建、修复中、待修复 → 统一映射为"待修复"状态

2. **缺陷停留时长分析**（柱状图）
   - 统计方法：仅统计待修复状态的缺陷
   - 计算方式：当前时间 - 创建时间（以天为单位）

3. **每日新增/修复缺陷情况**（折线图）
   - 每日新增：根据创建时间统计，count(标题)
   - 每日修复：待验证状态（使用更新时间）+ 已关闭状态（使用完成时间）

4. **缺陷分析归类统计**（饼图）
   - 根据缺陷分析归类字段统计成圆饼图

### 🔍 模块过滤功能

- 上传文件后自动解析出缺陷模块列表
- 支持多选模块（默认全选）
- 支持一键全选/取消全选
- 根据选择的模块动态过滤数据生成图表

### 🎨 现代化界面

- 渐变色背景设计
- 支持拖拽上传文件
- ECharts图表库，美观且交互友好
- 实时数据展示，无需下载文件

## 📋 安装说明

### 1. 安装依赖

```bash
# 激活虚拟环境
source venv/bin/activate

# 安装依赖包
pip install -r requirements.txt
```

### 2. 运行应用

```bash
# 使用启动脚本（推荐）
./start.sh

# 或手动启动
source venv/bin/activate
python app.py
```

应用将在 `http://localhost:5000` 启动

## 📝 使用方法

### 步骤1：上传Excel文件
1. 打开浏览器访问 `http://localhost:5000`
2. 点击上传区域或拖拽Excel文件到页面
3. 选择包含缺陷数据的.xlsx文件

### 步骤2：选择模块
1. 上传成功后，页面会自动显示所有缺陷模块
2. 默认全选所有模块
3. 可以取消选择某些模块来过滤数据

### 步骤3：生成图表
1. 点击"生成图表"按钮
2. 系统会根据选择的模块过滤数据
3. 在页面上实时展示4个统计图表

### 步骤4：查看和交互
- 图表支持鼠标悬停查看详细数据
- 可以重新选择模块并再次生成图表
- 所有图表响应式设计，支持窗口大小调整

## 📄 Excel文件格式要求

### 必需列

| 列名 | 说明 | 示例 |
|------|------|------|
| **标题** | 缺陷标题（用于计数） | 用户无法登录 |
| **状态** | 缺陷当前状态 | 新建、修复中、待修复、待验证、已关闭 |
| **创建时间** | 缺陷创建时间 | 2020-01-13 09:32:46 |
| **缺陷模块** | 缺陷所属模块 | 用户模块、订单模块 |
| **缺陷分析类型** | 缺陷分析归类 | A类、B类、C类 |

### 可选列

| 列名 | 说明 | 用途 |
|------|------|------|
| 更新时间 | 最后更新时间 | 用于计算修复缺陷（待验证状态） |
| 完成时间 | 完成时间 | 用于计算修复缺陷（已关闭状态） |
| 事项ID | 唯一标识 | 数据标识 |
| 事项类型 | 类型 | 缺陷、任务 |
| 标签 | 标签 | 【紧急】、【常规】 |
| 处理人 | 负责人 | 张三、李四 |
| 责任原因 | 原因 | 代码逻辑错误 |
| 缺陷分类 | 分类 | 功能缺陷、性能问题 |
| 缺陷级别 | 级别 | A、B、C、D |

### 状态映射规则

根据图片需求，以下状态会统一映射：
- **新建** → 待修复
- **修复中** → 待修复
- **待修复** → 待修复

其他状态保持不变（待验证、已关闭等）

### 示例数据格式

| 事项ID | 标题 | 状态 | 缺陷模块 | 缺陷分析类型 | 创建时间 | 更新时间 | 完成时间 |
|--------|------|------|----------|--------------|----------|----------|----------|
| 55694 | 用户无法登录 | 新建 | 用户模块 | A类 | 2020-01-13 09:32:46 | 2020-01-13 09:35:13 | |
| 55693 | 数据显示错误 | 已关闭 | 订单模块 | B类 | 2020-01-12 17:55:07 | 2020-01-13 09:23:27 | 2020-01-13 10:00:00 |

## 📊 生成的统计图表详解

### 图表1：不同状态下的缺陷数量统计
- **类型**：柱状图
- **位置**：左上角
- **统计方法**：
  - 应用状态映射规则（新建、修复中、待修复 → 待修复）
  - 按状态分组统计标题数量
  - count(标题) by 状态

### 图表2：缺陷分析归类统计
- **类型**：饼图
- **位置**：右上角
- **统计方法**：
  - 根据缺陷分析类型字段统计
  - 显示各类型占比
  - 圆环饼图展示

### 图表3：缺陷停留时长分析
- **类型**：柱状图
- **位置**：左下角
- **统计方法**：
  - **仅统计待修复状态**的缺陷
  - 计算：当前日期 - 创建日期（去掉时分秒）
  - 以天为单位统计
  - 按停留天数分组显示数量

### 图表4：每日新增/修复缺陷情况
- **类型**：双线折线图
- **位置**：右下角
- **统计方法**：
  - **每日新增**：
    - 根据创建时间，去掉时分秒
    - 按日期统计 count(标题)
  - **每日修复**：
    - 待验证状态：使用更新时间
    - 已关闭状态：使用完成时间
    - 两者合并统计

## 🛠️ 技术栈

- **后端框架**：Flask 3.1.2
- **数据处理**：Pandas 2.3.3+
- **Excel处理**：openpyxl 3.1.5（仅用于读取）
- **图表库**：ECharts 5.4.3
- **前端**：HTML5 + CSS3 + JavaScript
- **Python版本**：Python 3.8+

## 📁 项目结构

```
excel-draw-tool/
├── app.py                    # Flask应用主文件
├── create_sample_data.py     # 示例数据生成脚本
├── requirements.txt          # Python依赖列表
├── start.sh                  # 一键启动脚本（macOS/Linux）
├── init_git.sh               # Git初始化脚本
├── build.spec                # PyInstaller构建配置
├── README.md                 # 项目说明文档
├── QUICKSTART.md             # 快速开始指南
├── GITHUB_DEPLOY.md          # GitHub Actions部署指南
├── 使用说明.md               # 详细使用说明
├── .github/
│   └── workflows/
│       └── build.yml         # GitHub Actions配置
├── templates/                # HTML模板文件夹
│   └── index.html           # 主页面（带图表）
├── uploads/                  # 文件上传目录
├── venv/                     # Python虚拟环境
└── sample_defect_data.xlsx   # 示例数据文件
```

## 🚀 GitHub Actions 自动构建

本项目已配置GitHub Actions，可以自动构建Windows、macOS和Linux三个平台的可执行文件。

### 快速开始

1. **推送到GitHub**：
   ```bash
   ./init_git.sh
   # 按照提示完成GitHub仓库配置
   ```

2. **查看构建结果**：
   - 打开GitHub仓库的 `Actions` 标签
   - 等待构建完成
   - 下载对应平台的可执行文件

3. **发布版本**：
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```
   这会自动创建GitHub Release并上传所有平台的构建文件。

### 构建产物

- **Windows**: `excel-draw-tool-windows.zip`
- **macOS**: `excel-draw-tool-macos.tar.gz`
- **Linux**: `excel-draw-tool-linux.tar.gz`

详细说明请查看：[GITHUB_DEPLOY.md](GITHUB_DEPLOY.md)

## 🧪 测试应用

### 使用示例数据

项目已包含示例数据文件：`sample_defect_data.xlsx`

#### 测试步骤：
1. 启动应用后，在浏览器中打开 http://localhost:5000
2. 上传 `sample_defect_data.xlsx`
3. 查看自动生成的模块列表
4. 点击"生成图表"按钮
5. 查看页面上展示的4个统计图表

### 生成新的示例数据

```bash
# 激活虚拟环境
source venv/bin/activate

# 运行示例数据生成脚本
python create_sample_data.py
```

这将生成包含50条缺陷记录的新示例文件，包含5个不同的缺陷模块。

## ❓ 常见问题

### Q1: 上传失败，提示格式错误

**答**：请确保：
- 文件格式为 .xlsx（不支持旧版 .xls）
- 文件大小不超过16MB
- 文件未损坏
- Excel中包含必需的列（标题、状态、创建时间、缺陷模块、缺陷分析类型）

### Q2: 图表显示不完整或没有数据

**答**：请检查：
- Excel中是否有必需的列
- 列名是否精确匹配（注意中文字符）
- 数据中是否有大量空值
- 至少选择了一个模块

### Q3: 状态统计和预期不符

**答**：注意状态映射规则：
- 新建、修复中、待修复 → 统一显示为"待修复"
- 这是按照图片需求实现的特殊规则
- 其他状态（待验证、已关闭等）保持不变

### Q4: 缺陷停留时长图表为空

**答**：缺陷停留时长只统计"待修复"状态的缺陷：
- 如果数据中没有待修复状态的缺陷，图表会为空
- 请检查数据中是否有新建、修复中或待修复状态的记录

### Q5: 如何修改端口号？

**答**：编辑 `app.py` 文件的最后一行：
```python
app.run(debug=True, host='0.0.0.0', port=5000)  # 修改port参数
```

### Q6: 如何在局域网中访问？

**答**：启动应用后，使用你的电脑IP地址访问，例如：`http://192.168.1.100:5000`

查看本机IP：
```bash
# macOS/Linux
ifconfig | grep "inet "

# Windows
ipconfig
```

## 📌 注意事项

⚠️ **重要提示**：

1. **数据安全**：上传的文件临时存储在服务器，建议定期清理 uploads 目录
2. **文件大小**：支持的最大文件大小为16MB
3. **浏览器兼容**：建议使用Chrome、Edge、Safari等现代浏览器
4. **列名匹配**：Excel列名必须精确匹配（包括中文字符）
5. **时间格式**：时间列应为标准时间格式（如：2020-01-13 09:32:46）
6. **状态映射**：新建、修复中、待修复会统一映射为待修复状态

## 🆚 版本对比

### v2.0 (当前版本)
- ✅ Web页面实时展示图表（不再生成Excel文件）
- ✅ 支持模块过滤功能
- ✅ 实现状态映射规则
- ✅ 按照图片需求重新实现4个统计图表
- ✅ 使用ECharts美化图表
- ✅ 支持交互式数据探索

### v1.0 (旧版本)
- 生成Excel文件包含统计图表
- 无模块过滤功能
- 不同的统计规则

## 📞 技术支持

如有问题或建议，请参考项目文档或提issue。

## 📄 许可证

MIT License

---

**祝使用愉快！** 📊✨
